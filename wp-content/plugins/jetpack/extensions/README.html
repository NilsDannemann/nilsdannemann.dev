<html>
      <head>
        <meta charset="UTF-8">
        <title>README.md</title>
      </head>
      <body>
        <h1 id="jetpack-block-editor-extensions">Jetpack Block Editor Extensions</h1>
<p>This directory contains the source code for extensions in the block editor,
also known as Gutenberg, <a href="https://wordpress.org/news/2018/12/bebo/">that was introduced in WordPress 5.0</a>.</p>
<h2 id="extension-type">Extension Type</h2>
<p>We define different types of block editor extensions:</p>
<ul>
<li>Blocks are available in the editor itself.</li>
<li>Plugins are available in the Jetpack sidebar that appears on the right side of the block editor.</li>
</ul>
<h2 id="extension-structure">Extension Structure</h2>
<p>Extensions in the <code>extensions/blocks</code> folder loosely follow this structure:</p>
<pre><code>.
└── block-or-plugin-name/
    ├── block-or-plugin-name.php ← PHP file where the block and its assets are registered.
    ├── editor.js                ← script loaded only in the editor
    ├── editor.scss              ← styles loaded only in the editor
    ├── view.js                  ← script loaded in the editor and theme
    └── view.scss                ← styles loaded in the editor and theme
</code></pre><p>If your block depends on another block, place them all in extensions folder:</p>
<pre><code>.
├── block-name/
└── sub-blockname/
</code></pre><h2 id="developing-block-editor-extensions-in-jetpack">Developing block editor extensions in Jetpack</h2>
<h3 id="high-level-overview-of-the-development-flow">High-level overview of the development flow</h3>
<ol>
<li>Use the <a href="https://github.com/Automattic/jetpack/tree/master/docker#readme">Jetpack Docker environment</a>.</li>
<li>Start a new branch.</li>
<li>Add your new extension&#39;s source files to the extensions/blocks directory.
And add your extensions&#39; slug to the beta array in <code>extensions/index.json</code>. You can use Jetpack-CLI command to scaffold the block (see below).
By keeping your extension in the beta array, it&#39;s safe to do small PRs and merge frequently.</li>
<li>Or modify existing extensions in the same folder.</li>
<li>Run <code>yarn build-extensions [--watch]</code> to compile your changes.</li>
<li>Now test your changes in your Docker environment&#39;s wp-admin.</li>
<li>Open a PR, and a WordPress.com diff will be automatically generated with your changes.</li>
<li>Test the WordPress.com diff</li>
<li>Once the code works well in both environments and has been approved by a Jetpack crew member, you can merge your branch!</li>
<li>When your block is ready to be shipped, move your extensions&#39; slug from beta to production array in <code>extensions/index.json</code></li>
</ol>
<h3 id="beta-extensions">Beta Extensions</h3>
<p>Generally, all new extensions should start out as a beta.</p>
<ul>
<li>Before you develop, remember to add your extension&#39;s slug to the beta array in <code>extensions/index.json</code>.</li>
<li>In the <code>wp-config.php</code> for your Docker environment (<code>docker/wordpress/wp-config.php</code>) or in your custom mu-plugins file (<code>docker/mu-plugins/yourfile.php</code>), enable beta extensions with the following snippet: <code>define( &#39;JETPACK_BETA_BLOCKS&#39;, true );</code></li>
<li>In the WordPress.com environment, a12s will be able to see beta extensions with no further configuration</li>
<li>Once you&#39;ve successfully beta tested your new extension, you can open new PR to make your extension live!</li>
<li>Simply move the extension&#39;s slug out of the beta array and into the production array in <code>extensions/index.json</code>.</li>
</ul>
<h3 id="testing">Testing</h3>
<p>Run <code>yarn test-extensions [--watch]</code> to run tests written in <a href="https://jestjs.io/en/">Jest</a>.</p>
<p>Note that adding <a href="https://jestjs.io/docs/en/snapshot-testing">Jest snapshot tests</a> for block&#39;s <code>save</code> methods is problematic because many core packages relying on <code>window</code> that is not present when testing with Jest. See <a href="https://github.com/Automattic/wp-calypso/pull/30727">prior exploration</a>.</p>
<h2 id="scaffolding-blocks-with-wp-cli">Scaffolding blocks with WP-CLI</h2>
<p>We have a command in WP-CLI that allows to scaffold Jetpack blocks. Its syntax is as follows:</p>
<p><code>wp jetpack scaffold &lt;type&gt; &lt;title&gt; [--slug] [--description] [--keywords]</code></p>
<p><strong>Currently the only <code>type</code> is <code>block</code>.</strong></p>
<h3 id="options">Options</h3>
<ul>
<li><strong>title</strong>: Block name, also used to create the slug. This parameter is required. If it&#39;s something like <em>Logo gallery</em>, the slug will be <code>logo-gallery</code>. It&#39;s also used to generate the class name when an external edit component is requested. Following this example, it would be <code>LogoGalleryEdit</code>.</li>
<li><strong>--slug</strong>: Specific slug to identify the block that overrides the one generated base don the title.</li>
<li><strong>--description</strong>: Allows to provide a text description of the block.</li>
<li><strong>--keywords</strong>: Provide up to three keywords separated by a comma so users when they search for a block in the editor.</li>
</ul>
<h3 id="files">Files</h3>
<p>All files will be created in a directory under <code>extensions/blocks/</code> named after the block title or a specific given slug. For a hypothetical <strong>Jukebox</strong> block, it will create the following files</p>
<ul>
<li><code>extensions/blocks/jukebox/</code></li>
<li><code>extensions/blocks/jukebox/jukebox.php</code></li>
<li><code>extensions/blocks/jukebox/index.js</code></li>
<li><code>extensions/blocks/jukebox/editor.js</code></li>
<li><code>extensions/blocks/jukebox/editor.scss</code></li>
<li><code>extensions/blocks/jukebox/edit.js</code></li>
</ul>
<p>Additionally, the slug of the new block will be added to the <code>beta</code> array in the file <code>extensions/index.json</code>.
Since it&#39;s added to the beta array, you need to load the beta blocks as explained above to be able to test this block.</p>
<h3 id="examples">Examples</h3>
<p><code>wp jetpack scaffold block &quot;Cool Block&quot;</code></p>
<p><code>wp jetpack scaffold block &quot;Amazing Rock&quot; --slug=&quot;good-music&quot; --description=&quot;Rock the best music on your site&quot;</code></p>
<p><code>wp jetpack scaffold block &quot;Jukebox&quot; --keywords=&quot;music, audio, media&quot;</code></p>
<h3 id="can-i-use-jurassic-ninja-to-test-blocks-">Can I use Jurassic Ninja to test blocks?</h3>
<p>Yes! Just like any other changes in Jetpack, also blocks work in Jurassic Ninja.</p>
<p>Simply add branch name to the URL: jurassic.ninja/create/?jetpack-beta&amp;branch=master or use other ninjastic features.</p>
<h3 id="how-do-i-merge-extensions-to-jetpack">How do I merge extensions to Jetpack</h3>
<ul>
<li>Jetpack is released once a month, so be sure your team is aware of <a href="https://github.com/Automattic/Jetpack/milestones">upcoming code freezes</a>.</li>
<li>Make sure you and your team have tested your PR in both the Jetpack environment, and the WordPress.com environment.</li>
<li>Additionally, your PR will require approval from a Jetpack crew member.</li>
<li>Once merged, your extension will appear in the next release.</li>
</ul>
<h3 id="how-do-i-merge-extensions-to-wordpress-com-">How do I merge extensions to WordPress.com?</h3>
<ul>
<li>Merge to Jetpack master first.</li>
<li>Now, merge the auto-generated diff on WordPress.com.</li>
<li>There&#39;s no need to wait on release schedules, in fact it is best if you merge your WordPress.com diff immediately after you&#39;ve merged to Jetpack master.</li>
</ul>
<h3 id="what-if-i-need-to-manually-create-a-wordpress-com-diff-">What if I need to manually create a WordPress.com diff?</h3>
<p>You can build extensions from the Jetpack folder to your local sandbox folder and sync the whole sandbox like you always do:</p>
<pre><code class="lang-bash">yarn clean-extensions
yarn build-extensions \
  --output-path /PATH_TO_YOUR_SANDBOX/wp-content/mu-plugins/jetpack/_inc/blocks/ \
  --watch
</code></pre>
<p>Alternatively, if you don’t need to touch PHP files, you can build extensions in the Jetpack folder without --output-path and use rsync to push files directly to your sandbox:</p>
<pre><code class="lang-bash">rsync -az --delete _inc/blocks/ \
  YOUR_WPCOM_SANDBOX:/BLOCKS_PATH_IN_YOUR_SANDBOX/
</code></pre>
<p>To test extensions for a Simple site in Calypso, sandbox the simple site URL (<code>example.wordpress.com</code>). Calypso loads Gutenberg from simple sites’ wp-admin in an iframe.</p>
<h2 id="good-to-know-when-developing-gutenberg-extensions">Good to know when developing Gutenberg extensions</h2>
<h2 id="the-build">The Build</h2>
<ul>
<li>Compiled extensions are output to <code>_inc/blocks</code></li>
<li>You can view the various build commands in <code>package.json</code></li>
<li>You can see the build configuration in <code>webpack.config.extensions.js</code></li>
</ul>
<p>If you need to modify the build process, bear in mind that config files are also
synced to WordPress.com via Fusion. Consult with a Jetpack crew member to ensure
you test the new build in both environments.</p>
<h2 id="debugging">Debugging</h2>
<p>Setting these might be useful for debugging with block editor:</p>
<pre><code class="lang-php">define( &#39;SCRIPT_DEBUG&#39;, true );
define( &#39;GUTENBERG_DEVELOPMENT_MODE&#39;, true );
</code></pre>
<p>You could modify <code>SCRIPT_DEBUG</code> from <code>docker/wordpress/wp-config.php</code> in your Docker environment and add <code>GUTENBERG_DEVELOPMENT_MODE</code> there as well, or in your custom mu-plugins file (<code>docker/mu-plugins/yourfile.php</code>).</p>
<p><a href="https://wordpress.org/plugins/g-debugger/">G Debugger</a> plugin might come handy, too.</p>
<h3 id="don-t-worry-about-dependencies">Don&#39;t worry about dependencies</h3>
<p>The build takes care of core dependencies for both editor and view scripts. React, Lodash and <code>@wordpress/*</code> <a href="https://github.com/WordPress/gutenberg/blob/master/docs/contributors/scripts.md">dependencies</a> are externalized and automatically enqueued in PHP for your extension.</p>
<p>Extensions <em>always</em> get <a href="https://github.com/WordPress/gutenberg/blob/master/docs/contributors/scripts.md#polyfill-scripts">Gutenberg&#39;s polyfill scripts</a> enqueued so you can safely use methods not supported by older browsers such as IE11.</p>
<h3 id="jetpack-plugin-sidebar">Jetpack plugin sidebar</h3>
<p>Jetpack adds its own <a href="https://wordpress.org/gutenberg/handbook/designers-developers/developers/tutorials/plugin-sidebar-0/plugin-sidebar-1-up-and-running/">plugin sidebar</a> to the block editor. You can find it by choosing &quot;Jetpack&quot; from block the editor&#39;s ellipsis menu or by pressing the Jetpack icon in the &quot;pinned plugins&quot; toolbar.</p>
<p>The sidebar itself is always registered in the editor and populated using the <a href="https://github.com/WordPress/gutenberg/tree/master/packages/components/src/slot-fill#readme">Slot Fill</a> mechanism.</p>
<p>Use the <code>JetpackPluginSidebar</code> component to render from anywhere in your plugin&#39;s code:</p>
<pre><code class="lang-jsx">import JetpackPluginSidebar from &#39;../../shared/jetpack-plugin-sidebar&#39;;

&lt;JetpackPluginSidebar&gt;
    &lt;PanelBody title={ __( &#39;My sidebar section&#39;, &#39;jetpack&#39; ) }&gt;
        &lt;p&gt;Jetpack is Bestpack!&lt;/p&gt;
    &lt;/PanelBody&gt;
&lt;/JetpackPluginSidebar&gt;
</code></pre>
<p>The sidebar won&#39;t show up at all if nothing is being rendered in the sidebar&#39;s &quot;slot&quot;.</p>
<p>Remember to be mindful of what post types you want to enable your sidebar section for: e.g. posts, pages, custom post types, and re-usable block post type (<code>/wp-admin/edit.php?post_type=wp_block</code>).</p>
<p>See <a href="blocks/publicize/index.js">Publicize</a> and <a href="blocks/shortlinks/index.js">Shortlinks</a> for examples how to limit functionality only to some specific post types or posts. The <a href="blocks/likes/likes-checkbox.js">Likes</a> &amp; <a href="blocks/sharing/sharing-checkbox.js">Sharing</a> extensions are a great example of how to <a href="shared/jetpack-likes-and-sharing-panel.js">output</a> content from several extensions to one sidebar section using &quot;slots&quot;.</p>
<h3 id="i18n">i18n</h3>
<p>As of 04/2019, <code>wp.i18n</code> <a href="https://github.com/WordPress/gutenberg/issues/9846">doesn&#39;t support React elements in strings</a>. You will have to structure your copy so that links and other HTML can be translated separately.</p>
<p>Not possible:</p>
<pre><code class="lang-js">__( &#39;Still confused? Check out &lt;a&gt;documentation&lt;/a&gt; for more!&#39; )
</code></pre>
<p>Possible:</p>
<pre><code class="lang-jsx">{ __( &#39;Still confused?&#39; ) } &lt;a&gt;{ __( &#39;Check out documentation for more!&#39; ) }&lt;/a&gt;
</code></pre>
<h3 id="colors">Colors</h3>
<p>To stay consistent with Gutenberg, your extensions should follow <a href="https://wordpress.org/gutenberg/handbook/designers-developers/designers/block-design/">Gutenberg styles and visuals</a>.</p>
<p>Use Gutenberg color variables where possible by importing them in your stylesheet from <code>extensions/shared/styles/gutenberg-colors.scss</code>.</p>
<p>The build pipeline also supports <a href="https://github.com/Automattic/color-studio">Muriel colors</a> via SASS variables (<code>$muriel-pink-300</code>) and CSS custom properties (<code>var( --muriel-pink-300 )</code>) without specifically importing them first. Prefer CSS custom properties if possible.</p>
<h3 id="icons">Icons</h3>
<p>Please use outline versions of <a href="https://material.io/tools/icons/?style=outline">Material icons</a> to stay in line with Muriel guidelines. Don&#39;t rely on icons used in WordPress core to avoid visual mixing up with core blocks.</p>

      </body>
    </html>